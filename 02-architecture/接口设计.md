# XTrendAI æ¥å£è®¾è®¡æ–‡æ¡£ v2.1

## 1. APIè®¾è®¡åŸåˆ™

### 1.1 è®¾è®¡è§„èŒƒ

| è§„èŒƒ | è¯´æ˜ |
|-----|------|
| RESTfulé£æ ¼ | ä½¿ç”¨æ ‡å‡†HTTPæ–¹æ³•å’Œèµ„æºè·¯å¾„ |
| ç‰ˆæœ¬æ§åˆ¶ | URLä¸­ä¸åŒ…å«ç‰ˆæœ¬ï¼Œé€šè¿‡Headeræ§åˆ¶ |
| ç»Ÿä¸€å“åº”æ ¼å¼ | æ‰€æœ‰APIè¿”å›ç»Ÿä¸€çš„JSONç»“æ„ |
| é”™è¯¯å¤„ç† | ä½¿ç”¨HTTPçŠ¶æ€ç  + è¯¦ç»†é”™è¯¯ä¿¡æ¯ |
| å›½é™…åŒ–æ”¯æŒ | æ‰€æœ‰APIæ”¯æŒè¯­è¨€å‚æ•° |

### 1.2 åŸºç¡€URL

```
å¼€å‘ç¯å¢ƒ: http://localhost:3000/api
ç”Ÿäº§ç¯å¢ƒ: https://xtrendai.vercel.app/api
```

### 1.3 é€šç”¨è¯·æ±‚å¤´

```typescript
// æ‰€æœ‰APIè¯·æ±‚æ”¯æŒçš„å¤´
Headers {
  "Content-Type": "application/json"
  "Authorization": "Bearer {token}"  // å¯é€‰ï¼Œéœ€è¦è®¤è¯çš„API
  "X-User-ID": "{userId}"            // å¯é€‰ï¼ŒGuestæ¨¡å¼ä½¿ç”¨ç”Ÿæˆçš„ID
  "Accept-Language": "zh-CN|en-US"  // è¯­è¨€åå¥½ï¼Œå¯é€‰
  "X-Locale": "zh-CN"                // æ˜¾å¼è¯­è¨€è®¾ç½®ï¼Œä¼˜å…ˆçº§é«˜äºAccept-Language
}
```

### 1.4 è¯­è¨€å‚æ•°è¯´æ˜

| å‚æ•° | ä¼˜å…ˆçº§ | è¯´æ˜ |
|-----|-------|------|
| X-Locale | æœ€é«˜ | æ˜¾å¼æŒ‡å®šçš„è¯­è¨€ |
| Accept-Language | ä¸­ | HTTPæ ‡å‡†è¯­è¨€å¤´ |
| Cookie | ä½ | å­˜å‚¨çš„ç”¨æˆ·è¯­è¨€åå¥½ |
| é»˜è®¤å€¼ | - | zh-CN (ä¸­æ–‡) |

---

## 2. ç»Ÿä¸€å“åº”æ ¼å¼

### 2.1 æˆåŠŸå“åº”

```typescript
interface SuccessResponse<T> {
  success: true
  data: T
  message?: string        // å¯é€‰çš„æˆåŠŸæ¶ˆæ¯
  timestamp: string       // ISO 8601æ ¼å¼
}

// ç¤ºä¾‹
{
  "success": true,
  "data": {
    "trends": [...]
  },
  "timestamp": "2026-02-26T10:30:00Z"
}
```

### 2.2 é”™è¯¯å“åº”

```typescript
interface ErrorResponse {
  success: false
  error: {
    code: string          // é”™è¯¯ä»£ç 
    message: string       // ç”¨æˆ·å‹å¥½çš„é”™è¯¯æè¿°
    details?: any         // é¢å¤–é”™è¯¯è¯¦æƒ…
  }
  timestamp: string
}

// ç¤ºä¾‹
{
  "success": false,
  "error": {
    "code": "QUOTA_EXCEEDED",
    "message": "ä»Šæ—¥è·å–æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œè¯·æ˜å¤©å†è¯•æˆ–å‡çº§Pro",
    "details": {
      "limit": 10,
      "used": 10,
      "resetsAt": "2026-02-27T00:00:00Z"
    }
  },
  "timestamp": "2026-02-26T10:30:00Z"
}
```

### 2.3 HTTPçŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|-------|------|---------|
| 200 | OK | è¯·æ±‚æˆåŠŸ |
| 201 | Created | èµ„æºåˆ›å»ºæˆåŠŸ |
| 400 | Bad Request | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | Unauthorized | æœªæˆæƒ |
| 403 | Forbidden | æ— æƒé™è®¿é—® |
| 404 | Not Found | èµ„æºä¸å­˜åœ¨ |
| 429 | Too Many Requests | è¶…å‡ºé…é¢/é™æµ |
| 500 | Internal Server Error | æœåŠ¡å™¨é”™è¯¯ |

---

## 3. APIç«¯ç‚¹å®šä¹‰

### 3.1 çƒ­ç‚¹ç›¸å…³API

#### GET /api/trends

è·å–ä¸ªæ€§åŒ–çƒ­ç‚¹åˆ—è¡¨ã€‚

**è¯·æ±‚å‚æ•°**

```typescript
interface GetTrendsRequest {
  userId?: string        // å¯é€‰ï¼Œç”¨æˆ·ID (Guestä»Cookieè·å–)
  forceRefresh?: boolean // å¯é€‰ï¼Œå¼ºåˆ¶åˆ·æ–°ç¼“å­˜
}
```

**è¯·æ±‚ç¤ºä¾‹**

```bash
GET /api/trends
```

**å“åº”æ•°æ®**

```typescript
interface Trend {
  id: string              // çƒ­ç‚¹IDï¼Œå¦‚ "trend-superbowl-2026"
  name: string            // çƒ­ç‚¹åç§°ï¼Œå¦‚ "#SuperBowl2026"
  displayName?: string    // æ˜¾ç¤ºåç§°ï¼ˆå»é™¤#ï¼‰
  volume: number          // æ¨æ–‡é‡
  growthRate: number      // å¢é•¿ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
  category: string        // åˆ†ç±»: sports/tech/entertainmentç­‰
  regions: string[]       // ç›¸å…³åœ°åŒº: us/cn/uk/jp/global
  isPublic: boolean       // æ˜¯å¦ä¸ºå…¬å…±çƒ­ç‚¹
  relatedTweets?: number  // ç›¸å…³æ¨æ–‡æ•°é‡
  url?: string            // Xå¹³å°é“¾æ¥
  updatedAt: string       // æ›´æ–°æ—¶é—´
}

interface GetTrendsResponse {
  trends: Trend[]
  total: number
  lastUpdated: string
  nextRefreshAt?: string  // ä¸‹æ¬¡å¯åˆ·æ–°æ—¶é—´
}
```

**æˆåŠŸå“åº”ç¤ºä¾‹**

```json
{
  "success": true,
  "data": {
    "trends": [
      {
        "id": "trend-superbowl-2026",
        "name": "#SuperBowl2026",
        "displayName": "SuperBowl2026",
        "volume": 1200000,
        "growthRate": 15.2,
        "category": "sports",
        "regions": ["us"],
        "isPublic": true,
        "relatedTweets": 1200000,
        "url": "https://x.com/search?q=%23SuperBowl2026",
        "updatedAt": "2026-02-26T10:00:00Z"
      },
      {
        "id": "trend-oscars-2026",
        "name": "#Oscars2026",
        "displayName": "Oscars2026",
        "volume": 890000,
        "growthRate": 8.5,
        "category": "entertainment",
        "regions": ["global"],
        "isPublic": true,
        "updatedAt": "2026-02-26T09:45:00Z"
      }
    ],
    "total": 2,
    "lastUpdated": "2026-02-26T10:00:00Z",
    "nextRefreshAt": "2026-02-26T11:00:00Z"
  },
  "timestamp": "2026-02-26T10:30:00Z"
}
```

**é”™è¯¯å“åº”**

```json
{
  "success": false,
  "error": {
    "code": "QUOTA_EXCEEDED",
    "message": "ä»Šæ—¥è·å–æ¬¡æ•°å·²è¾¾ä¸Šé™",
    "details": {
      "limit": 10,
      "used": 10,
      "resetsAt": "2026-02-27T00:00:00Z"
    }
  },
  "timestamp": "2026-02-26T10:30:00Z"
}
```

---

### 3.2 ä»»åŠ¡ç›¸å…³API

#### POST /api/tasks

æ ¹æ®çƒ­ç‚¹ç”Ÿæˆåœºæ™¯ä»»åŠ¡ã€‚

**è¯·æ±‚å‚æ•°**

```typescript
interface GenerateTasksRequest {
  trendId: string          // çƒ­ç‚¹ID
  scenarios?: Scenario[]   // å¯é€‰ï¼ŒæŒ‡å®šåœºæ™¯ï¼Œé»˜è®¤ä½¿ç”¨ç”¨æˆ·é…ç½®çš„åœºæ™¯
  userId?: string          // å¯é€‰ï¼Œç”¨æˆ·ID
}
```

**è¯·æ±‚ç¤ºä¾‹**

```json
{
  "trendId": "trend-superbowl-2026",
  "scenarios": ["POD", "MARKETING"]
}
```

**å“åº”æ•°æ®**

```typescript
interface Task {
  id: string               // ä»»åŠ¡ID
  trendId: string          // æ‰€å±çƒ­ç‚¹ID
  scenario: Scenario       // åœºæ™¯ç±»å‹
  type: string             // ä»»åŠ¡ç±»å‹ (tshirt/mug/title/descriptionç­‰)
  title: string            // ä»»åŠ¡æ ‡é¢˜
  content: string          // ä»»åŠ¡å†…å®¹ (æç¤ºè¯/æ–‡æ¡ˆç­‰)
  wordCount: number        // å­—æ•°ç»Ÿè®¡
  templateId: string       // ä½¿ç”¨çš„æ¨¡æ¿ID
  createdAt: string        // ç”Ÿæˆæ—¶é—´
}

interface ScenarioTasks {
  scenario: Scenario
  scenarioName: string     // åœºæ™¯æ˜¾ç¤ºåç§°
  tasks: Task[]
}

interface GenerateTasksResponse {
  trend: Trend
  scenarios: ScenarioTasks[]
}
```

**æˆåŠŸå“åº”ç¤ºä¾‹**

```json
{
  "success": true,
  "data": {
    "trend": {
      "id": "trend-superbowl-2026",
      "name": "#SuperBowl2026",
      "displayName": "SuperBowl2026"
    },
    "scenarios": [
      {
        "scenario": "POD",
        "scenarioName": "PODæŒ‰éœ€æ‰“å°",
        "tasks": [
          {
            "id": "task-pod-tshirt-001",
            "trendId": "trend-superbowl-2026",
            "scenario": "POD",
            "type": "tshirt",
            "title": "Tæ¤è®¾è®¡æç¤ºè¯",
            "content": "A trendy t-shirt design for Super Bowl 2026, featuring a stylized football helmet with team colors, minimalist vector art style, suitable for print-on-demand",
            "wordCount": 24,
            "templateId": "pod-tshirt-v1",
            "createdAt": "2026-02-26T10:30:00Z"
          },
          {
            "id": "task-pod-tote-001",
            "trendId": "trend-superbowl-2026",
            "scenario": "POD",
            "type": "tote",
            "title": "å¸†å¸ƒè¢‹è®¾è®¡æç¤ºè¯",
            "content": "A chic tote bag design inspired by Super Bowl 2026, football and cheer theme, pastel color palette, aesthetic illustration style",
            "wordCount": 20,
            "templateId": "pod-tote-v1",
            "createdAt": "2026-02-26T10:30:00Z"
          }
        ]
      },
      {
        "scenario": "MARKETING",
        "scenarioName": "è¥é”€æ–‡æ¡ˆ",
        "tasks": [
          {
            "id": "task-marketing-title-001",
            "trendId": "trend-superbowl-2026",
            "scenario": "MARKETING",
            "type": "title",
            "title": "ä¿ƒé”€æ ‡é¢˜",
            "content": "ğŸˆ Touchdown! æŠ“ä½ Super Bowl 2026 æ½®æµï¼Œé™æ—¶ä¼˜æƒ ï¼",
            "wordCount": 8,
            "templateId": "marketing-title-v1",
            "createdAt": "2026-02-26T10:30:00Z"
          }
        ]
      }
    ]
  },
  "timestamp": "2026-02-26T10:30:00Z"
}
```

---

### 3.3 ç”¨æˆ·ç›¸å…³API

#### GET /api/user/profile

è·å–ç”¨æˆ·ç”»åƒé…ç½®ã€‚

**å“åº”æ•°æ®**

```typescript
interface UserProfile {
  userId: string
  role: UserRole            // guest/free/pro/admin
  region: Region
  ageGroup: AgeGroup
  ethnicity?: Ethnicity
  scenarios: Scenario[]
  createdAt: string
  updatedAt: string
}

type Region = 'us' | 'cn' | 'uk' | 'jp' | 'global'
type AgeGroup = '18-24' | '25-34' | '35-44' | '45+'
type Ethnicity = 'asian' | 'black' | 'hispanic' | 'white' | 'other'
type Scenario = 'POD' | 'CONTENT' | 'MARKETING' | 'DEVELOPMENT'
type UserRole = 'guest' | 'free' | 'pro' | 'admin'
```

**æˆåŠŸå“åº”ç¤ºä¾‹**

```json
{
  "success": true,
  "data": {
    "userId": "user-abc123",
    "role": "free",
    "region": "us",
    "ageGroup": "25-34",
    "ethnicity": "asian",
    "scenarios": ["POD", "MARKETING"],
    "createdAt": "2026-02-20T10:00:00Z",
    "updatedAt": "2026-02-26T09:00:00Z"
  },
  "timestamp": "2026-02-26T10:30:00Z"
}
```

#### PUT /api/user/profile

æ›´æ–°ç”¨æˆ·ç”»åƒé…ç½®ã€‚

**è¯·æ±‚å‚æ•°**

```typescript
interface UpdateProfileRequest {
  region?: Region
  ageGroup?: AgeGroup
  ethnicity?: Ethnicity | null  // nullè¡¨ç¤ºæ¸…é™¤
  scenarios?: Scenario[]
}
```

**è¯·æ±‚ç¤ºä¾‹**

```json
{
  "region": "cn",
  "ageGroup": "25-34",
  "scenarios": ["POD", "CONTENT", "MARKETING"]
}
```

**å“åº”æ•°æ®**ï¼šä¸ GET /api/user/profile ç›¸åŒ

---

#### GET /api/user/quota

è·å–ç”¨æˆ·é…é¢ä¿¡æ¯ã€‚

**å“åº”æ•°æ®**

```typescript
interface QuotaInfo {
  userId: string
  role: UserRole
  limits: {
    dailyFetch: number      // æ¯æ—¥è·å–çƒ­ç‚¹æ¬¡æ•°ä¸Šé™
    dailyCopy: number       // æ¯æ—¥å¤åˆ¶æ¬¡æ•°ä¸Šé™
    scenarioCount: number   // å¯é€‰åœºæ™¯æ•°é‡
    refreshInterval: number // åˆ·æ–°é—´éš”ï¼ˆåˆ†é’Ÿï¼‰
  }
  usage: {
    fetchCount: number
    copyCount: number
    lastFetchAt: string | null
    lastCopyAt: string | null
  }
  resetsAt: string          // é…é¢é‡ç½®æ—¶é—´
}
```

**æˆåŠŸå“åº”ç¤ºä¾‹**

```json
{
  "success": true,
  "data": {
    "userId": "user-abc123",
    "role": "free",
    "limits": {
      "dailyFetch": 10,
      "dailyCopy": 20,
      "scenarioCount": 2,
      "refreshInterval": 60
    },
    "usage": {
      "fetchCount": 3,
      "copyCount": 5,
      "lastFetchAt": "2026-02-26T10:00:00Z",
      "lastCopyAt": "2026-02-26T10:05:00Z"
    },
    "resetsAt": "2026-02-27T00:00:00Z"
  },
  "timestamp": "2026-02-26T10:30:00Z"
}
```

---

### 3.4 è®¤è¯ç›¸å…³API

#### POST /api/auth/login

ç”¨æˆ·ç™»å½•/æ³¨å†Œï¼ˆMVPé˜¶æ®µç®€åŒ–ï¼‰ã€‚

**è¯·æ±‚å‚æ•°**

```typescript
interface LoginRequest {
  email: string
  name?: string
}
```

**å“åº”æ•°æ®**

```typescript
interface LoginResponse {
  user: {
    id: string
    email: string
    name?: string
    role: UserRole
  }
  token?: string           // JWT token (V2.0)
  isNewUser: boolean       // æ˜¯å¦ä¸ºæ–°æ³¨å†Œç”¨æˆ·
  profileComplete: boolean // ç”»åƒæ˜¯å¦å·²å®Œæˆ
}
```

**æˆåŠŸå“åº”ç¤ºä¾‹**

```json
{
  "success": true,
  "data": {
    "user": {
      "id": "user-abc123",
      "email": "user@example.com",
      "name": "John Doe",
      "role": "free"
    },
    "isNewUser": false,
    "profileComplete": true
  },
  "timestamp": "2026-02-26T10:30:00Z"
}
```

#### POST /api/auth/logout

ç”¨æˆ·ç™»å‡ºã€‚

**å“åº”ç¤ºä¾‹**

```json
{
  "success": true,
  "message": "ç™»å‡ºæˆåŠŸ",
  "timestamp": "2026-02-26T10:30:00Z"
}
```

---

## 4. é”™è¯¯ä»£ç å®šä¹‰

| ä»£ç  | HTTPçŠ¶æ€ | è¯´æ˜ |
|-----|---------|------|
| `INVALID_REQUEST` | 400 | è¯·æ±‚å‚æ•°æ— æ•ˆ |
| `UNAUTHORIZED` | 401 | æœªæˆæƒè®¿é—® |
| `FORBIDDEN` | 403 | æ— æƒé™æ“ä½œ |
| `USER_NOT_FOUND` | 404 | ç”¨æˆ·ä¸å­˜åœ¨ |
| `TREND_NOT_FOUND` | 404 | çƒ­ç‚¹ä¸å­˜åœ¨ |
| `QUOTA_EXCEEDED` | 429 | é…é¢è¶…é™ |
| `RATE_LIMITED` | 429 | è¯·æ±‚é¢‘ç‡è¶…é™ |
| `INTERNAL_ERROR` | 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| `SERVICE_UNAVAILABLE` | 503 | æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ |

---

## 5. é…é¢è§„åˆ™

### 5.1 æŒ‰è§’è‰²é…é¢

| è§’è‰² | æ¯æ—¥è·å– | æ¯æ—¥å¤åˆ¶ | åœºæ™¯æ•°é‡ | åˆ·æ–°é—´éš” |
|-----|---------|---------|---------|---------|
| Guest | æ— é™* | 3æ¬¡ | 1ä¸ª(å›ºå®šPOD) | - |
| Free | 10æ¬¡ | 20æ¬¡ | 2ä¸ª | 60åˆ†é’Ÿ |
| Pro | æ— é™ | æ— é™ | å…¨éƒ¨ | å®æ—¶ |
| Admin | æ— é™ | æ— é™ | å…¨éƒ¨ | å®æ—¶ |

* Guestä»…èƒ½è®¿é—®å…¬å…±çƒ­ç‚¹ï¼Œä¸æ¶ˆè€—é…é¢

### 5.2 é…é¢è®¡ç®—

```typescript
// è·å–çƒ­ç‚¹æ¶ˆè€—é…é¢
GET /api/trends -> quota.fetchCount += 1

// å¤åˆ¶ä»»åŠ¡æ¶ˆè€—é…é¢
POST /api/tasks/copy -> quota.copyCount += 1

// æŸ¥çœ‹ä»»åŠ¡ä¸æ¶ˆè€—é…é¢
GET /api/tasks -> æ— æ¶ˆè€—
```

---

## 6. APIè°ƒç”¨ç¤ºä¾‹

### 6.1 å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```typescript
// è·å–çƒ­ç‚¹
async function fetchTrends() {
  const response = await fetch('/api/trends')
  const result = await response.json()

  if (result.success) {
    return result.data.trends
  } else {
    // å¤„ç†é”™è¯¯
    if (result.error.code === 'QUOTA_EXCEEDED') {
      // æ˜¾ç¤ºé…é¢æç¤º
    }
    throw new Error(result.error.message)
  }
}

// ç”Ÿæˆä»»åŠ¡
async function generateTasks(trendId: string) {
  const response = await fetch('/api/tasks', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ trendId })
  })
  const result = await response.json()
  return result.data
}

// æ›´æ–°ç”¨æˆ·ç”»åƒ
async function updateProfile(profile: Partial<UserProfile>) {
  const response = await fetch('/api/user/profile', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(profile)
  })
  const result = await response.json()
  return result.data
}
```

---

## 7. APIç‰ˆæœ¬æ¼”è¿›

### V1.0 (MVP)

- åŸºç¡€APIåŠŸèƒ½
- ç®€å•é‰´æƒï¼ˆåŸºäºLocal Storageï¼‰
- æ¨¡æ‹Ÿæ•°æ®

### V2.0

- JWTå®Œæ•´é‰´æƒ
- X APIé›†æˆ
- ç®¡ç†åå°API

### V3.0

- WebSocketå®æ—¶æ¨é€
- æ‰¹é‡æ“ä½œAPI
- é«˜çº§ç­›é€‰API

---

*æ–‡æ¡£ç‰ˆæœ¬: v2.1*
*åˆ›å»ºæ—¥æœŸ: 2026-02-26*
*æœ€åæ›´æ–°: 2026-02-26 (æ–°å¢è¯­è¨€å‚æ•°æ”¯æŒ)*
*è´Ÿè´£äºº: ç³»ç»Ÿæ¶æ„å¸ˆ*
